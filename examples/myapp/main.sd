import { render_gui, setState } from "gui"
import { ListView } from "./views/list.sd"
import { FormView } from "./views/form.sd"

function App() {
    const [view, setView] = setState("list")
    const [items, setItems] = setState([
        { id: 1, name: "Apple" },
        { id: 2, name: "Banana" }
    ])
    const [editItem, setEditItem] = setState(null)

    return (
        <Page width="100%" height="100%" backgroundColor="#f5f5f5">
            {view == "list" && (
                <ListView
                    items={items}
                    onAdd={() => {
                        setEditItem(null)
                        setView("form")
                    }}
                    onEdit={(item) => {
                        setEditItem(item)
                        setView("form")
                    }}
                    onDelete={(id) => {
                        var filtered = items.filter((i) => {
                            return i.id != id
                        })
                        setItems(filtered)
                    }}
                />
            )}

            {view == "form" && (
                <FormView
                    item={editItem || null}
                    onSave={(data) => {
                        println("onSave received data:")
                        println(data)
                        if (editItem) {
                            var updated = items.map((i) => {
                                return i.id == editItem.id ? data : i
                            })
                            setItems(updated)
                        } else {
                            setItems([
                                ...items,
                                { ...data, id: DateNow() }
                            ])
                        }
                        setView("list")
                    }}
                    onCancel={() => {
                        setView("list")
                    }}
                />
            )}
        </Page>
    )
}

render_gui(App)